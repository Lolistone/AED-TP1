\documentclass[10pt,a4paper]{article}

\input{AEDmacros}
\usepackage{caratula} % Version modificada para usar las macros de algo1 de ~> https://github.com/bcardiff/dc-tex


\titulo{Trabajo Práctico 1}
\subtitulo{Especificación y Weakest Precondition}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{swifties}

\integrante{Cordoba Lazzaro, Lisandro}{327/23}{lisandrocordoba11@gmail.com}
\integrante{Martinelli, Lorenzo}{364/23}{martinelli.lorenzo12@gmail.com}
\integrante{Nahum, Felipe}{424/23}{felipenahum28@gmail.com}
% Pongan cuantos integrantes quieran

% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

\begin{document}

\maketitle

\section{Especificación}

\noindent Algunas consideraciones que tuvimos al especificar:
\begin{enumerate} \setlength\itemsep{0cm}
	\item Un escrutinio tiene al menos dos partidos, y en la ultima posicion estan los votos en blanco.
	\item Tanto en el escrutinio como en la matriz DHont no hay repetidos.
	\item Los escrutinios en hayFraude tienen la misma longitud.
	\item Los votos en el escrutinio y los cocientes de la matriz son numeros mayores o iguales a 0.
	\item En la matriz DHont los partidos que no pasaron el umbral estaran representados como una lista vacia.
	\item En las listas de los partidos representamos a hombres con el 1 y mujeres con el 2.
\end{enumerate}
Los predicados y auxiliares utilizados están definidos al final de la sección. \\

\subsection{Ejercicio 1}

\begin{proc}{hayBallotage}{\In escrutinio : \TLista{\ent}}{Bool}
	%    \modifica{parametro1, parametro2,..}
	\requiere{escrutinioValido(escrutinio)}
	\asegura{res = True \longleftrightarrow \neg ((\paraTodo[unalinea]{j,k}{\ent}{0 \leq j,k < |escrutinio| - 1  \yLuego porcentaje(j, escrutinio) > 40  	\implicaLuego \\
		   	porcentaje(j, escrutinio) - porcentaje(k, escrutinio) > 10}) \lor \\
		  	\existe[unalinea]{i}{\ent}{\paraTodo[unalinea]{j}{\ent}{0 \leq i,j < |escrutinio| - 1 \yLuego porcentaje(i, escrutinio)  > 45 \land i \neq j  \implicaLuego \\ porcentaje(j, escrutinio) \leq 45}})}
\end{proc}

\subsection{Ejercicio 2}

\begin{proc}{hayFraude}{\In escrutinio\_presidencial : \TLista{\ent}, \In escrutinio\_senadores : \TLista{\ent}, \In escrutinio\_diputados : \TLista{\ent}}{Bool}
	%    \modifica{parametro1, parametro2,..}
	\requiere{|escrutinio\_presidencial| = |escrutinio\_senadores| \land |escrutinio\_senadores| = |escrutinio\_diputados| \land \\
	escrutinioValido(escrutinio\_presidencial) \land escrutinioValido(escrutinio\_senadores) \\ \land escrutinioValido(escrutinio\_presidencial)}
	\asegura{res = True \longleftrightarrow totalVotos(escrutinio\_presidencial) =  totalVotos(escrutinio\_senador) \land  \\  totalVotos(escrutinio\_senadores) =  totalVotos(escrutinio\_diputados)}
\end{proc}

\subsection{Ejercicio 3}

\begin{proc}{obtenerSenadoresEnProvincia}{\In escrutinio : \TLista{\ent}}{$\ent \times \ent$}
	%    \modifica{parametro1, parametro2,..}
	\requiere{escrutinioValido(escrutinio)}
	\asegura{(0 \leq res_{0}, res_{1} < |escrutinio| - 1) \yLuego \paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| - 1 \land i \neq res_{0}
	i \neq res_{1} \implicaLuego \\ escrutinio[i] < escrutinio[res_{1}]} \land res_{1} < res_{0}} 
\end{proc}

\subsection{Ejercicio 4}

\begin{proc}{calcularDHontEnProvincia}{\In cant\_bancas : \ent, \In escrutinio : \TLista{\ent}}{\TLista{\TLista{\ent}}}
	%    \modifica{parametro1, parametro2,..}
	\requiere{cant\_bancas > 0 \land escrutinioValido(escrutinio)}
	\asegura{|res| = |escrutinio| - 1 \yLuego \\
	\paraTodo[unalinea]{i}{\ent}{0 \leq i < |res| \yLuego superaUmbral(escrutinio[i]) \implicaLuego |res[i]| =  cant\_bancas} \land \\
	\paraTodo[unalinea]{i}{\ent}{0 \leq i < |res| \yLuego \neg(superaUmbral(escrutinio[i])) \implicaLuego |res[i]| =  0} \land \\
	\paraTodo[unalinea]{i,j}{\ent}{0 \leq i < |res| \yLuego 0 \leq j < |res[i]| \implicaLuego res[i][j] =  escrutinio[i]/(j + 1)}}
\end{proc}

\subsection{Ejercicio 5}

\begin{proc}{obtenerDiputadosEnProvincia}{\In cant\_bancas : \ent, \In escrutinio : \TLista{\ent} \In DHont : \TLista{\TLista{\ent}}}{\TLista{\ent}}
	%    \modifica{parametro1, parametro2,..}
	\requiere{cant\_bancas > 0 \yLuego dHontValida(DHont, cant\_bancas, escrutinio)}
	\asegura{|res| = |DHont| \yLuego \\ \paraTodo[unalinea]{i}{\ent}{0 \leq i < |res| \implicaLuego res[i] = \sum\limits_{j=0}^{|DHont[i]|-1} \IfThenElse{cant\_bancas > \#cocientesMayores(DHont[i][j], DHont)}{1}{0}}}
	 
\end{proc}

\subsection{Ejercicio 6}

\vspace{0.1cm}

\begin{proc}{validarListasDiputadosEnProvincia}{\In cant\_bancas : \ent, \In listas : \TLista{\TLista{dni : \ent \times genero : \ent}}}{Bool}
	%    \modifica{parametro1, parametro2,..}
	\requiere{cant\_bancas > 0 \land generosValidos(listas)}
	\asegura{res = True \longleftrightarrow \\
\paraTodo[unalinea]{i}{\ent}{0 \leq i < |listas| \implicaLuego  |listas[i]|= cant\_bancas} \land \\ 
\paraTodo[unalinea]{i,j}{\ent}{0 \leq i < |listas| \yLuego 0 \leq j < |listas[i]| - 1 \yLuego listas[i][j]_{1} = 1 \implicaLuego  listas[i][j+1]_{1} = 2 } \land \\  \paraTodo[unalinea]{i,j}{\ent}{0 \leq i < |listas| \yLuego 0 \leq j < |listas[i]| - 1 \yLuego listas[i][j]_{1} = 2 \implicaLuego  listas[i][j+1]_{1} = 1 }}
\end{proc}

\subsection{Predicados y Auxiliares}

\aux{porcentaje}{\In partido : {\ent}, \In escrutinio : \TLista{\ent}}{\ent}{(escrutinio[partido] * 100) / totalVotos(escrutinio)}
\aux{\#cocientesMayores}{\In i : \ent, \In j : \ent, \In DHont : \TLista{\TLista{\ent}}}{\ent}{\\ \sum\limits_{r=0}^{|DHont[i]|-1} \sum\limits_{k=0}^{|DHont|-1} \IfThenElse{DHont[k][r] > DHont[i][j]}{1}{0}}
\aux{totalVotos}{\In escrutinio : \TLista{\ent}}{\ent}{\sum\limits_{i=0}^{|escrutinio|-1} escrutinio[i]}
\pred{noHayEmpate}{\In escrutinio : \TLista{\ent}}{\paraTodo[unalinea]{i,j}{\ent}{0 \leq i,j < |escrutinio| - 1  \land i \neq j  \implicaLuego escrutinio[i] \neq escrutinio[j] }}
\pred{votosValidos}{\In escrutinio : \TLista{\ent}}{\paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| \implicaLuego escrutinio[i] \geq 0 }}
\pred{escrutinioValido}{\In escrutinio : \TLista{\ent}}{|escrutinio| > 2 \land noHayEmpate(escrutinio) \land votosValidos(escrutinio)}
\pred{cocientesDistintos}{\In DHont : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{i,j,k,r}{\ent}{0 \leq i,k < |DHont| \yLuego 0 \leq j, r < |DHont[i]| \land
|DHont[i]| = |DHont[k]| \land (i \neq k \lor j \neq r) \implicaLuego 
DHont[i][j] \neq DHont[k][r]}}
\pred{cocientesPositivos}{\In DHont : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{i,j}{\ent}{0 \leq i < |DHont| \yLuego 0 \leq j < |DHont[i]| \implicaLuego DHont[i][j] \geq 0}}
\pred{filasValidas}{\In DHont : \TLista{\TLista{\ent}}, \In cant\_bancas : \ent}{\paraTodo[unalinea]{i}{\ent}{0 \leq i < |DHont| \yLuego |DHont[i]| > 0  \implicaLuego |DHont[i]| =  cant\_bancas}}
\pred{dHontValida}{\In DHont : \TLista{\TLista{\ent}}, \In cant\_bancas : \ent, \In escrutinio : \TLista{\ent}}{
|escrutinio| - 1 = |DHont| \land filasValidas(DHont, cant\_bancas) \land cocientesPositivos(DHont) \land cocientesDistintos(DHont)} 
\pred{generosValidos}{\In Listas : \TLista{\TLista{\ent \times \ent}}}{\paraTodo[unalinea]{i,j}{\ent}{0 \leq i < |listas| \yLuego 0 \leq j < |listas[i]| \implicaLuego listas[i][j]_{1} = 1 \lor  listas[i][j]_{1} = 2}}

\newpage

\section{Implemetaciones y demostraciones de correctitud}

\subsection{Implementación de hayBallotage}

	\begin{lstlisting}[caption={},label=code:for]
i := 0;
totalVotos := 0;
while (i < escrutinio.size()) do
	totalVotos := totalVotos + escrutinio[i];
	i := i + 1
endwhile
primero := 0;
segundo := 0;
j := 0;
while (i < escrutinio.size() - 1) do
	if (escrutinio[j] > primero) then
		segundo := primero;
		primero := escrutinio[j];
	else
		if (primero > escrutinio[j] && escrutinio[j] > segundo) then
			segundo := escrutinio[j];
		else
			skip;
		endif
	endif
	j := j + 1
endwhile
primero := (primero/totalVotos)*100
segundo :=  (segundo/totalVotos)*100
diferencia := primero - segundo
res :=  (primero <= 45 || segundo > 45) && (primero < 40 || diferencia <= 10) 
	\end{lstlisting}

\subsection{Implementación de hayFraude}

	\begin{lstlisting}[caption={},label=code:for]
i := 0;
total_presidencial := 0;
total_senadores := 0;
total_diputados := 0;
while (i < escrutinio_presidencial.size()) do
	total_presidencial := total_presidencial + escrutinio_presidencial[i];
	total_senadores := total_senadores + escrutinio_senadores[i];
	total_diputados := total_diputados + escrutinio_diputados[i];
	i := i + 1
endwhile
res := (total_presidencial = total_senadores) && (total_senadores = total_diputados)
	\end{lstlisting}

\subsection{Implementacion validarListasDiputadosEnProvincia}

	\begin{lstlisting}[caption={},label=code:for]
i := 0;
res := True
while (i < listas.size() - 1) do
	res := res && |listas[i]| = |listas[i+1]|
endwhile
while (j < listas.size()) do
	while (k < listas[j].size() - 1) do
		res := res && listas[j][k][1] != listas[j][k+1][1]
		k := k + 1
	endwhile
	j := j +1
endwhile
	\end{lstlisting}

\subsection{Implementación de obtenerSenadoresEnProvincia}

	\begin{lstlisting}[caption={},label=code:for]
primero := 0;
segundo := 0;
i := 1;
while (i < escrutinio.size() - 1) do
	if (escrutinio[i] > escrutinio[primero]) then
		segundo := primero;
		primero := i;
	else
		if (escrutinio[i] > escrutinio[segundo]) then
			segundo := i;
		else
			skip;
		endif
	endif
	i := i + 1
endwhile
res := (primero, segundo)
	\end{lstlisting}


\subsection{Demostracion de correctitud de hayFraude}



Para probar que el algoritmo propuesto es correcto vamos a dividirlo en subprogramas:

\vspace{0.3cm}

$S_1$
	\begin{lstlisting}[caption={},label=code:for]
i := 0;
total_presidencial := 0;
total_senadores := 0;
total_diputados := 0;
	\end{lstlisting}

\vspace{0.3cm}

$Ciclo$
	\begin{lstlisting}[caption={},label=code:for]
while (i < escrutinio_presidencial.size()) do
	total_presidencial := total_presidencial + escrutinio_presidencial[i];
	total_senadores := total_senadores + escrutinio_senadores[i];
	total_diputados := total_diputados + escrutinio_diputados[i];
	i := i + 1
endwhile
	\end{lstlisting}

\vspace{0.3cm}

$S_2$


	\begin{lstlisting}[caption={},label=code:for]
res := (total_presidencial = total_senadores) && (total_senadores = total_diputados)
	\end{lstlisting}

\vspace{0.3cm}

Y, luego probaremos que,


\begin{enumerate}\setlength{\itemindent}{0.5cm}
		\item Requiere $\rightarrow$ wp($S_1$, $P_c$)
		\item $P_c$ $\rightarrow$ wp(Ciclo, $Q_c$)
		\item $Q_c$ $\rightarrow$ wp($S_2$, Asegura)
\end{enumerate}

Si probamos estas tres cosas, por el corolario de monotonía tenemos que, \vspace{0.2cm} \\
\indent \qquad \quad Requiere $\rightarrow$ wp(hayFraude, Asegura)

\vspace{0.3cm}

Comencemos eligiendo, \vspace{0.3cm} \\
$\textbf P_{c} \equiv i=0 \land total\_presidencial = 0 \land total\_senadores = 0 \land total\_diputados = 0 \land \\ |escrutinio\_senadores| = |escrutinio\_presidente| \land |escrutinio\_senadores| = |escrutinio\_diputados| \land \\
escrutinioValido(escrutinio\_presidente)  \land escrutinioValido(escrutinio\_presidente) \land escrutinioValido(escrutinio\_presidente) \vspace{0.1cm} $
(Es lo mínimo que podemos pedir basandonos en el Requiere más aplicar S1) \vspace{0.1cm}\\
$\textbf Q_{c} \equiv total\_presidencial = totalVotos(escrutinio\_presidencial) \land  total\_diputados = totalVotos(escrutinio\_diputados) \land total\_senadores = totalVotos(escrutinio\_senadores) \land i = |escrutinio\_presidencial| \vspace{0.1cm} $ \\
(Similar al asegura, con la diferencia de que no hablamos de res) \vspace{0.1cm} \\
$\textbf B \equiv i < |escrutinio\_presidencial|$ \vspace{0.1cm}\\
(Es la guarda del ciclo) \vspace{0.1cm} \\
$\textbf I \equiv 0 \leq i \leq |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] \land \\
0 \leq i \leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i \leq |escrutinio\_diputados| \yLuego total\_diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k]$ \vspace{0.1cm} \\
(Como el ciclo incrementa i, el invariante muestra que total\_presidencial, total\_senadores y total\_diputados contienen 
las sumas parciales de sus elementos hasta i-1) \vspace{0.1cm} \\
$\textbf{Fv}= |escrutinio\_presidencial| - i $

\subsection{1. $Requiere \rightarrow wp(S_1, P_c)$}

\noindent Primero calculo \textbf{wp($S_1$, $P_c$)} \vspace{0.1cm} \\
\textbf{wp$(i:=0; total\_presidencial = 0 ; total\_senadores = 0 ;total\_diputados = 0, P_c)$} \vspace{0.1cm}\\
(Por axioma 3, calculamos de afuera hacia dentro) \vspace{0.1cm}\\
$ \textbf{wp}(total\_diputados := 0, P_{c}) \equiv def(0) \yLuego i=0 \land total\_presidente = 0 \land total\_senadores = 0 \land 0=0\land \\ |escrutinio\_senadores| = |escrutinio\_presidente| \land |escrutinio\_senadores| = |escrutinio\_diputados| \land \\
escrutinioValido(escrutinio\_presidente)  \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \vspace{0.1cm} $ \\
$ \equiv i=0 \land total\_presidente = 0 \land total\_senadores = 0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \land \\ |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente)  \\ \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \equiv E_1  \vspace{0.5cm} $ 

\noindent $\textbf{wp}(total\_senadores := 0, E_1) \equiv def(0) \yLuego i=0 \land total\_presidente = 0 \land 0 = 0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \land |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente)  \\ \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \vspace{0.1cm} $

\noindent $\equiv i=0 \land total\_presidente = 0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \land \\ |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente)  \\ \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \equiv E_2 \vspace{0.5cm} $ 

\noindent $\textbf{wp}(total\_presidente := 0, E_2) \equiv def(0) \yLuego i=0 \land 0=0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \\ \land |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente)  \\ \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \vspace{0.1cm} $

\noindent $ \equiv i=0 \land total\_presidente = 0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \land \\ |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente) \land \\ escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \equiv E_3 \vspace{0.5cm} $

\noindent $\textbf{wp}(total\_presidente := 0, E_3) \equiv def(0) \yLuego 0=0 \land |escrutinio\_senadores| = |escrutinio\_presidente| \\ \land |escrutinio\_senadores| = |escrutinio\_diputados| \land
escrutinioValido(escrutinio\_presidente)  \\ \land escrutinioValido(escrutinio\_senadores) \land escrutinioValido(escrutinio\_diputados) \vspace{0.1cm} $

\noindent $ \equiv |escrutinio\_senadores| = |escrutinio\_presidente| \land |escrutinio\_senadores| = |escrutinio\_diputados| \land \\
escrutinioValido(escrutinio\_presidente) \land escrutinioValido(escrutinio\_senadores) \land \\ escrutinioValido(escrutinio\_diputados) \equiv E_4 \vspace{0.5cm} $

Ahora, como $Requiere \equiv E_4, Requiere \rightarrow E_4$ que es lo que queriamos ver.

\newpage 

\subsection{2. $P_c \rightarrow wp(Ciclo, Q_c)$ }

\vspace{0.1cm}

\noindent Para probar la correctitud del Ciclo, debemos probar que, \\

\noindent $P_c \rightarrow I$, es decir, que el invariante vale al entrar al ciclo.

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item  $0 \leq i \leq |escrutino\_senadores| \land 0 \leq i \leq |escrutino\_diputados| \equiv  0 \leq i \leq |escrutino\_presidencial|$ (1)
	\item $0 \leq i \leq |escrutino\_presidencial|$ (Vale pues i = 0)
	\item $total\_presidencial = \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] \equiv 0 = 0 \equiv True$ (2)
	\item $total\_senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \equiv 0 = 0 \equiv True$
	\item $total\_diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k] \equiv 0 = 0 \equiv True$
\end{itemize}

\noindent (1) De $P_c$ deduzco que $|escrutinio\_senadores| = |escrutinio\_presidente| \land |escrutinio\_diputados| = |escrutinio\_presidente|$
\noindent (2) Por un lado, tenemos que $total\_presidente = 0$ y por otro, como i = 0, tengo $\sum\limits_{k=0}^{0 - 1} escrutinio\_presidencial[k] = 0 \vspace{0.1cm}$

\noindent Por lo tanto, $P_c \rightarrow I$, que es lo que queria ver. \vspace{0.1cm}\\

\noindent Ahora tenemos que probar que $I \land \neg B \rightarrow Q_c$, o sea, que el invariante y la negacion de la guarda implican la postcondición del ciclo. \vspace{0.1cm}

\noindent $I \land \neg B \equiv \\ i = |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] \land \\
0 \leq i \leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i \leq |escrutinio\_diputados| \yLuego total\_diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k] \vspace{0.1cm}$

\noindent Veamos parte por parte,

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item $i = |escrutinio\_presidencial|$ (trivial)
	\item $total\_presidencial = totalVotos(escrutinio\_presidencial) \\ \equiv \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] = \sum\limits_{k=0}^{|escrutinio\_presidencial| - 1} escrutinio\_presidencial[k]  \\
	\equiv \sum\limits_{k=0}^{|escrutinio\_presidencial| - 1} escrutinio\_presidencial[k] = \sum\limits_{k=0}^{|escrutinio\_presidencial| - 1} escrutinio\_presidencial[k]$ (1)
	\item $total\_senadores = totalVotos(escrutinio\_senadores)$ (2)
	\item $total\_diputados = totalVotos(escrutinio\_diputados)$ (3)
\end{itemize}

\noindent (1) Vale pues $total\_presidencial$ = sumatoria hasta i - 1, pero i = $|escrutinio\_presidencial|$ \vspace{0.1cm} \\
\noindent (2), (3) Análogos. \vspace{0.1cm}\\

\noindent Queda entonces probado que I vale al salir del ciclo. \\

\noindent Por ultimo, nos queda probar la tripla de Hoare \{I $\land$ B\}CuerpoDelCiclo\{I\} para demostrar que, en caso de que el ciclo termine, es correcto respecto a la especificación.
Para esto debemos probar que I $\land$ B $\rightarrow$ wp(CuerpoDelCiclo, I) \vspace{0.1cm}\\

\noindent Calculamos primero \textbf{wp}(CuerpoDelCiclo, I) \\

\noindent Utilizando el Axioma 3, calculamos desde abajo hacia arriba el cuerpo del ciclo \\

\newpage

\noindent \textbf{wp}(i := i + 1, I)

\noindent $\equiv$ def(i+1) $\yLuego$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total\_diputados = \sum\limits_{k=0}^{i} escrutinio\_diputados[k]$ \vspace{0.1cm} \\

\noindent $\equiv$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total\_diputados = \sum\limits_{k=0}^{i} escrutinio\_diputados[k] \equiv E_6 $ \vspace{0.3cm} \\

\noindent \textbf{wp}(total$\_$diputados := total$\_$diputados + escrutinio$\_$diputados[i], $E_6$) \\

\noindent $\equiv$ def(total$\_$diputados + escrutinio$\_$diputados[i]) $\yLuego$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego \\ total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego \\ total\_senadores = \sum\limits_{k=0}^{i} escrutinio\_senadores[k] \land
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego \\ total$\_$diputados + escrutinio$\_$diputados[i] = \sum\limits_{k=0}^{i} escrutinio\_diputados[k]$ \vspace{0.1cm} \\

\noindent (Resto a ambos lados escrutinio$\_$diputados[i], ahora la sumatoria va hasta i-1) \\

\noindent $\equiv$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total$\_$diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k]\equiv E_7 $ \vspace{0.3cm} \\

\noindent \textbf{wp}(total$\_$senadores := total$\_$senadores + escrutinio$\_$senadores[i], $E_7$) \\

\noindent $\equiv$ def(total$\_$senadores + escrutinio$\_$senadores[i]) $\yLuego$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego \\ total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego \\ total$\_$senadores + escrutinio$\_$senadores[i] = \sum\limits_{k=0}^{i} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total$\_$diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k] $ \vspace{0.1cm} \\

\noindent $\equiv$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total$\_$senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total$\_$diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k]\equiv E_8 $ \vspace{0.3cm} \\

\noindent \textbf{wp}(total$\_$presidencial := total$\_$presidencial + escrutinio$\_$presidencial[i], $E_8$) \\

\noindent $\equiv$ def(total$\_$presidencial + escrutinio$\_$presidencial[i]) $\yLuego$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego \\ total$\_$presidencial + escrutinio$\_$presidencial[i] = \sum\limits_{k=0}^{i} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total$\_$senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total$\_$diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k] $ \vspace{0.1cm} \\

\noindent $\equiv$ $0 \leq i + 1 \leq |escrutinio\_presidencial| \yLuego total$\_$presidencial = \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] \land \\
0 \leq i + 1\leq |escrutinio\_senadores| \yLuego total$\_$senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i + 1 \leq |escrutinio\_diputados| \yLuego total$\_$diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k] \equiv E_9 $ \vspace{0.3cm} \\

\noindent Resta ver que $I \land B \rightarrow E_9$  \\

\noindent $I \land B \equiv $ $ 0 \leq i < |escrutinio\_presidencial| \yLuego total\_presidencial = \sum\limits_{k=0}^{i - 1} escrutinio\_presidencial[k] \land \\
0 \leq i \leq |escrutinio\_senadores| \yLuego total\_senadores = \sum\limits_{k=0}^{i - 1} escrutinio\_senadores[k] \land \\
0 \leq i \leq |escrutinio\_diputados| \yLuego total\_diputados = \sum\limits_{k=0}^{i - 1} escrutinio\_diputados[k]$ \vspace{0.1cm} \\

\noindent Asumiendo $I \land B$ verdadero,

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item $-1 \leq i < |escrutinio\_presidencial| \land -1 \leq i < |escrutinio\_senadores| \land -1 \leq i < |escrutinio\_diputados|$ (1)
	\item Las tres igualdades restantes son triviales.
\end{itemize}

\noindent (1) vale pues si 0 $\leq i < |s| $ en particular, $-1 \leq i < |s|$. \\

\noindent Luego, sabemos que el ciclo, en caso de terminar, es correcto. \\

\noindent Resta probar que el ciclo termina. Para ellos vamos a probar que, \\

\noindent $I \land fv \leq 0 \rightarrow \neg B$ \\

\noindent $I \land fv \leq 0 \equiv I \land |escrutinio\_presidencial| - i \leq 0 \equiv I \land |escrutinio\_presidencial| \leq i \equiv I \land \neg B$ \\

\noindent Luego, $I \land \neg B \rightarrow \neg B$ pues $p \land q \rightarrow q$ \\

\noindent Nos queda probar $\{I \land B \land v_0 = fv\}$CuerpoDelCiclo$\{fv < v_0\}$ \\

\noindent Calculemos wp(CuerpoDelCiclo, $|escrutinio\_presidencial| - i < v_0$) \\

\noindent Nuevamente, por Axioma 3 calculamos desde la ultima linea del ciclo. \vspace{0.1cm} \\

\noindent wp(i := i + 1, $|escrutinio\_presidencial| - i < v_0$) \\

\noindent $\equiv$ def(i + 1) $\yLuego$ $|escrutino\_presidencial|$  - $i < v_0 + 1$\\

\noindent $\equiv$ $|escrutino\_presidencial|$  - $i < v_0 + 1$ $\equiv E_{10}$ \vspace{0.3cm} \\

\noindent wp(total$\_$diputados := total$\_$diputados + escrutinio\_diputados[i], $E_{10}$) \\

\noindent $\equiv$ def(total$\_$diputados + escrutinio\_diputados[i]) $\yLuego$ $E_{10}$ \\

\noindent $\equiv$ 0 $\leq i < |escrutinio\_diputados|$ $\yLuego$ $|escrutino\_presidencial|$  - $i < v_0 + 1 \equiv E_{11}$ \vspace{0.3cm}\\


\noindent wp(total$\_$senadores := total$\_$senadores + escrutinio\_senadores[i], $E_{11}$) \\

\noindent $\equiv$ def(total$\_$senadores + escrutinio\_senadores[i]) $\yLuego$ $E_{11}$ \\

\noindent $\equiv$  0 $\leq i < |escrutinio\_senadores| \yLuego 0 \leq i < |escrutinio\_diputados|$ $\yLuego$ $|escrutino\_presidencial|$  - $i < v_0 + 1 \equiv E_{12} $ \vspace{0.3cm}\\

\newpage

\noindent wp(total$\_$presidencial := total$\_$presidencial + escrutinio\_presidencial[i], $E_{12}$) \\

\noindent $\equiv$ def(total$\_$presidencial + escrutinio\_presidencial[i]) $\yLuego$ $E_{12}$ \\

\noindent $\equiv$   0 $\leq i < |escrutinio\_presidencial| $ $\yLuego $ 0 $\leq i < |escrutinio\_senadores| \yLuego 0 \leq i < |escrutinio\_diputados|$ $\yLuego$ \\ $|escrutino\_presidencial|$  - $i < v_0 + 1 \equiv E_{13} $ \vspace{0.3cm}\\

\noindent Para finalizar, probando que $I \land B \land v_0 = $ $|escrutinio\_presidencial|$ - i $\rightarrow E_{13}$ tenemos que el ciclo termina. Por lo tanto, el ciclo es correcto. \\

\noindent Nuevamente, asumo verdadero $I \land B \land v_0 = $ $|escrutinio\_presidencial|$  - i

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item $|escrutino\_presidencial| - i < v_0 + 1  \equiv |escrutino\_presidencial| -  i < |escrutino\_presidencial| -  i + 1 \equiv True$
	\item  0 $\leq i < |escrutinio\_presidencial| $ $\yLuego $ 0 $\leq i < |escrutinio\_senadores| \yLuego 0 \leq i < |escrutinio\_diputados|$ (1)
\end{itemize}

\noindent (1) es trivial pues aparecen las mismas expresiones en $I \land B $. \\

\noindent Luego, el ciclo termina y es correcto.

\subsection{3. $Q_C \rightarrow wp(S_2, Asegura)$}

\noindent Calculamos \textbf{wp}($S_2$, Asegura) \vspace{0.1cm} \\
\noindent \textbf{wp}($res := (total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados)$, Asegura) \vspace{0.1cm} \\
$\equiv def((total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados)) \yLuego \\ 
(total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados) = True \longleftrightarrow \\ totalVotos(escrutinio\_presidencial) =  totalVotos(escrutinio\_senador) \land  \\  totalVotos(escrutinio\_senadores) =  totalVotos(escrutinio\_diputados) \vspace{0.1cm} $

\noindent $\equiv (total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados) = True \longleftrightarrow totalVotos(escrutinio\_presidencial) =  totalVotos(escrutinio\_senador) \land  totalVotos(escrutinio\_senadores) =  totalVotos(escrutinio\_diputados  \equiv E_5 \vspace{0.3cm}$

\noindent Quiero ver que $Q_c \rightarrow E_5 \vspace{0.1cm}$

\noindent Asumo verdadero $Q_c$ y tengo que,

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item $totalVotos(escrutinio\_presidencial) =  totalVotos(escrutinio\_senador) \equiv total\_presidencial = 		total\_senadores$ 
	\item $totalVotos(escrutinio\_senadores) =  totalVotos(escrutinio\_diputados) \equiv total\_senadores = 		total\_diputados$
\end{itemize}

\noindent  Luego, \\

\noindent $E_5 \equiv (total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados) = True \longleftrightarrow \\
(total\_presidencial = total\_senadores) \land (total\_senadores = total\_diputados) \vspace{0.3cm}$

\noindent Lo cual es una tautologia, por lo tanto $Q_c \rightarrow E_5$ \\

\noindent Ya probadas las tres implicaciones (1), (2) y (3) por el corolario de monotonia, el programa es correcto.

\newpage

\subsection{Demostracion de correctitud de obtenerSenadoresEnProvincia}

Ahora, como en el ejercicio anterior para probar que el algoritmo propuesto es correcto vamos a dividirlo en subprogramas:

\vspace{0.3cm}

$S_1$
	\begin{lstlisting}[caption={},label=code:for]
primero := 0;
segundo := 0;
i := 1;
	\end{lstlisting}

\vspace{0.3cm}

$Ciclo$
	\begin{lstlisting}[caption={},label=code:for]
while (i < escrutinio.size() - 1) do
	if (escrutinio[i] > escrutinio[primero]) then
		segundo := primero;
		primero := i;
	else
		if (escrutinio[i] > escrutinio[segundo]) then
			segundo := i;
		else
			skip;
		endif
	endif
	i := i + 1
endwhile
	\end{lstlisting}

\vspace{0.3cm}

$S_2$

	\begin{lstlisting}[caption={},label=code:for]
res := (primero, segundo)
	\end{lstlisting}

\vspace{0.3cm}

Y, luego probaremos que,


\begin{enumerate}\setlength{\itemindent}{0.5cm}
		\item Requiere $\rightarrow$ wp($S_1$, $P_c$)
		\item $P_c$ $\rightarrow$ wp(Ciclo, $Q_c$)
		\item $Q_c$ $\rightarrow$ wp($S_2$, Asegura)
\end{enumerate}

Si probamos estas tres cosas, por el corolario de monotonía tenemos que, \vspace{0.2cm} \\
\indent \qquad \quad Requiere $\rightarrow$ wp(obtenerSenadoresEnProvincia, Asegura)

\vspace{0.3cm}

Comencemos eligiendo, \vspace{0.3cm} \\
$\textbf P_{c} \equiv escrutinioValido(escrutinio) \land i = 1 \land segundo = 0 \land primero = 0 $ \vspace{0.1cm} \\
(Es el requiere mas las instrucciones previas al ciclo) \vspace{0.1cm} \\
$\textbf Q_{c} \equiv (0 \leq res_{0}, res_{1} < |escrutinio| - 1) \yLuego \paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| - 1 \land i \neq res_{0}
i \neq res_{1} \implicaLuego \\ escrutinio[i] < escrutinio[res_{1}]} \land escrutinio[res_{1}] < escrutinio[res_{0}] \vspace{0.1cm} $ \\
(Similar al asegura, con la diferencia de que no hablamos de res) \vspace{0.1cm} \\
$\textbf B \equiv i < |escrutinio| - 1 $ \vspace{0.1cm}\\
(Es la guarda del ciclo) \vspace{0.1cm} \\
$\textbf I \equiv 0 < i \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land 
j \neq segundo \implicaLuego \\ escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio) $ \vspace{0.1cm} \\
(Como el ciclo incrementa i, primero y segundo son los dos indices de escrutinio donde estan respectivamente los dos valores maximos hasta i) \vspace{0.1cm} \\
$\textbf{Fv}= |escrutinio| - i $ \\
(A medida que i aumenta en cada iteracion, fv decrece)

\newpage

\subsection{1. $Requiere \rightarrow wp(S_1, P_c)$} \vspace{0.1cm}

\noindent Primero calculo \textbf{wp($S_1$, $P_c$)} \\

\noindent \textbf{wp$(primero := 0 ;segundo := 0 ;i:= 1, P_c)$} \\

\noindent (Utilizando el Axioma 3)\\

\noindent \textbf{wp$(primero := 0, wp(segundo := 0, wp(i:=1, P_c)))$}\\

\noindent Calculemos entonces, \\

\noindent \textbf{wp$(i:=1, P_c)$} \vspace{0.1cm} \\
\noindent $\equiv$ def(i := 1) $\yLuego$ $\equiv$ escrutinioValido(escrutinio) $\land$ 1 = 1 $\land$ segundo = 0 $\land$ primero = 0 \\
\noindent $\equiv$ escrutinioValido(escrutinio) $\land$ segundo = 0 $\land$ primero = 0 $\equiv$ $E_1$ \\

\noindent \textbf{wp$(segundo :=0, E_1)$} \vspace{0.1cm} \\
\noindent $\equiv$ def(segundo := 0) $\yLuego$ $\equiv$ escrutinioValido(escrutinio) $\land$ 0 = 0 $\land$ primero = 0 \\
\noindent $\equiv$ escrutinioValido(escrutinio) $\land$ primero = 0 $\equiv$ $E_2$ \\

\noindent \textbf{wp$(primero :=0, E_2)$} \vspace{0.1cm} \\
\noindent $\equiv$ def(primero := 0) $\yLuego$ $\equiv$ escrutinioValido(escrutinio) $\land$ 0 = 0\\
\noindent $\equiv$ escrutinioValido(escrutinio) $\equiv$ $E_3$ \\

\noindent Luego, como Requiere $\equiv$ $E_3$, Requiere $\rightarrow$ $E_3$ que es lo que queriamos ver.

\subsection{2. $P_c \rightarrow wp(Ciclo, Q_c)$ }

\vspace{0.1cm}

\noindent Para probar la correctitud del Ciclo, debemos probar que, 

\begin{enumerate}\setlength{\itemindent}{0.5cm}
	\item $P_c \rightarrow I$
	\item $I \land \neg B \rightarrow Q_c$
	\item \{I $\land$ B\}CuerpoDelCiclo\{I\}
	\item $I \land fv \leq 0 \rightarrow \neg B$
	\item $\{I \land B \land v_0 = fv\}$CuerpoDelCiclo$\{fv < v_0\}$ \\
\end{enumerate}

\noindent 1. Asumimos que vale $P_c$ y queremos ver que I vale,

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item  $0 < i \leq |escrutinio| - 1$ vale pues i = 1 y $|escrutinio| > 2.$
	\item $0 \leq primero, segundo < i$ vale pues i = 1, segundo = 0 y primero = 0.
	\item  $\paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land  j \neq segundo \implicaLuego  escrutinio[j] < escrutinio[segundo]}  (1)$
	\item escrutinio[segundo] $\leq$ escrutinio[primero] vale pues escrutinio[0] $\leq$ escrutinio[0]
	\item noHayEmpate(escrutinio) vale pues esta dento de escrutinioValido(escrutinio)
\end{itemize}

\noindent (1) Como i = 1, el unico valor que cumple 0 $\leq j < i$ es j = 0, pero como primero y segundo son iguales a cero todo el antecedente es falso.
Por otro lado, para todo j $\neq$ 0 el antecedente también es falso. Luego, la implicacion siempre es verdadera. \\

\noindent Por lo tanto, $P_c \rightarrow I$ \\

\noindent 2. Asumiendo $I \land \neg B$ válido, donde \\

\noindent $I \land \neg B$ $\equiv$ $ i = |escrutinio| - 1 \yLuego  (0 \leq primero, segundo < i) \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land j \neq segundo \implicaLuego \\ escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio)$ \\

\noindent Quiero probar que vale $Q_c$

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item  $(0 \leq primero, segundo < |escrutinio| - 1) \equiv (0 \leq primero, segundo < i) \equiv True $   $ (i = |escrutinio| - 1) $
	\item   $\paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| - 1 \land i \neq primero \land i \neq segundo \implicaLuego escrutinio[i]< escrutinio[segundo]}$ (1)
	\item   escrutinio[segundo] $<$ escrutinio[primero] (2) 
\end{itemize}


\noindent (1) vale pues tengo que  $\paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[i]< escrutinio[segundo]} \land i = |escrutinio| - 1$  \\
\noindent (2) vale pues escrutinio[segundo] $\leq$ escrutinio[primero] $\land$ noHayEmpate(escrutinio) \\

\noindent Queda entonces probado lo que queriamos ver. \\

\noindent 3. Para probar la tripla, quiero ver que $I \land B \rightarrow wp(CuerpoDelCiclo, I)$ \\

\noindent Calculamos la wp(If ...; i := i + 1, I)  $\equiv$ wp(If ..., wp(i := i + 1, I)) \\

\noindent \textbf{wp}(i := i + 1, I) $\equiv$  def(i+1) $\yLuego$ $ 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land 
j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \\ \land noHayEmpate(escrutinio) $  \\

\noindent $\equiv$  $ 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio) \equiv E_5 $ \vspace{0.1cm} \\

\noindent Tenemos que ver ahora, \vspace{0.1cm}\\

\noindent \textbf{wp}(If escrutinio[i] $>$ escrutinio[primero] ..., $E_5$) \\

\noindent $\equiv def(escrutinio[i] > escrutinio[primero]) \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land wp(segundo := primero; primero := i, E_5))
\lor \\ (escrutinio[i] \leq escrutinio[primero]) \land wp(If escrutinio[i] > escrutinio[segundo] ..., E_5))$ \\

\noindent $\equiv 0 \leq i, primero < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land wp(segundo := primero; primero := i, E_5))
\lor \\ (escrutinio[i] \leq escrutinio[primero]) \land wp(If escrutinio[i] > escrutinio[segundo] ..., E_5))$ \\

\noindent Por comodidad, veamos las dos wp que hay dentro por separado \vspace{0.1cm} \\

\noindent \textbf{wp}(segundo := primero; primero := i, $E_5$) $\equiv$ wp(segundo := primero, wp(primero := i, $E_5$)) \vspace{0.1cm} \\

\noindent $wp(primero := i, E_5) \equiv def(i) \yLuego 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq i, segundo < i + 1 \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq i \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[i] \land noHayEmpate(escrutinio)$ \\

\noindent $ \equiv 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq i, segundo < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq i \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[i] \land noHayEmpate(escrutinio) \equiv E_6$ \\

\noindent \textbf{wp}(segundo := primero, $E_6$)  \\

\noindent $\equiv def(primero) \yLuego 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq i, primero < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq i \land j \neq primero \implicaLuego escrutinio[j] < escrutinio[primero]} \\ \land escrutinio[primero] \leq escrutinio[i] \land noHayEmpate(escrutinio) $ \\

\noindent $\equiv 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq i, primero < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq i \land j \neq primero \implicaLuego escrutinio[j] < escrutinio[primero]} \\ \land escrutinio[primero] \leq escrutinio[i] \land noHayEmpate(escrutinio) \equiv E_7$ \\

\noindent Ya tenemos calculada la wp del lado izquierdo del or, veamos el derecho \vspace{0.1cm} \\

\noindent \textbf{wp}(If escrutinio[i] $>$ escrutinio[segundo] ..., $E_5$) \\

\noindent $\equiv def(escrutinio[i] > escrutinio[segundo]) \yLuego \\
((escrutinio[i] > escrutinio[segundo] \land wp(segundo := i, E_5)) \lor \\ 
(escrutinio[i] \leq escrutinio[segundo] \land wp(skip, E_5) ) )$ \\

\noindent $\equiv 0 \leq i, segundo < |escrutinio| \yLuego \\
((escrutinio[i] > escrutinio[segundo] \land def(i) \yLuego  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, i < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq i \implicaLuego escrutinio[j] < escrutinio[i]} \\ \land escrutinio[i] \leq escrutinio[primero] \land noHayEmpate(escrutinio) ) \lor \\ 
(escrutinio[i] \leq escrutinio[segundo] \land  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \\ 
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio))) \equiv E_8$ \\

\noindent Reescribamos todo, \vspace{0.1cm} \\ 

\noindent $\equiv 0 \leq i, primero < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land E_7)
\lor \\ (escrutinio[i] \leq escrutinio[primero]) \land E_8) \equiv E_9 $\\

\noindent Lo que necesito es probar que $I \land B \rightarrow E_9$ para eso, voy a reescribir el Invariante de otra manera, para eso primero voy a mirar lo siguiente, \\

\noindent Si tengo 3 numero enteros, sean a, b y c,  donde sé que no hay repetidos (en este caso el noHayEmpates me lo garantizaria), tengo $3!$ maneras de ordenarlos, $(a < b < c) \lor (a < c < b) \lor (b < a <c) \lor (b < c < a) \lor (c < a < b) \lor (c < b <  a)$. Pero si además, pido que a $>$ b, (En este caso me lo garantiza,
que escrutinio[primero] $>$ escrutinio[segundo]) me quedo solo con 3 posibilidades que son $(b < a < c) \lor (b < c < a) \lor (c < b < a)$ \\

\noindent $I \equiv I \land True \equiv I \land (escrutinio[i] < escrutinio[segundo] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[i] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[primero] < escrutinio[i])$ \\

\noindent Luego, I $\land$ B es igual a \vspace{0.1cm} \\

\noindent $\equiv 0 < i < |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land j \neq segundo \implicaLuego \\ escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio) 
\land \\ (escrutinio[i] < escrutinio[segundo] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[i] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[primero] < escrutinio[i]) 
$ \\

\noindent Comecemos notando que,

\begin{itemize}\setlength{\itemindent}{0.5cm}
	\item  $0 \leq i, primero < |escrutinio|$
	\item $escrutinio[i] > escrutinio[primero]$
	\item $escrutinio[i] \leq escrutinio[primero] \equiv escrutinio[i] < escrutinio[primero]$ (noHayEmpate)
\end{itemize}

\noindent Son verdaderas pues  $0 < i < |escrutinio| - 1$, y por distribuir esta nueva parte del invariante. \vspace{0.1cm} \\

\noindent Nos queda entonces, \vspace{0.1cm} \\

\noindent $E_9 \equiv E_7 \lor E_8$ \\

\noindent Notemos que los tres casos que agregue al invariante son disjuntos, voy entonces asumir cada uno por separado. \vspace{0.1cm} \\

\noindent Si escrutinio[segundo] $<$ escrutinio[primero] $<$ escrutinio[i] \\

\noindent $E_7 \equiv 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq i, primero < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \implicaLuego escrutinio[j] < escrutinio[primero]} \\ \land escrutinio[primero] \leq escrutinio[i] \land noHayEmpate(escrutinio) $ \\

\noindent (Los rangos valen y escrutinio[primero] $\leq$ escrutinio[i] $\land$ noHayEmpate(escrutinio) es trivial) \\

\noindent $E_7 \equiv \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \implicaLuego escrutinio[j] < escrutinio[primero]} $ \\

\noindent (Veamos que ocurre cuando el antecedente es verdadero, escrutinio[j] $<$ escrutinio[primero] tambien lo es
puesto que en el invariante tenemos que j no es el primero ni el segundo entonces es menor al segundo y ademas tenemos que escrutinio[segundo] $<$ escrutinio[primero]. Si j = segundo los escrutinios serian iguales, entonces escrutinio[j] $<$ escrutinio[primero], sigue valiendo)\\

\noindent $E_7 \equiv True \rightarrow E_9 \equiv True $ pues es una unión

\noindent Segundo caso, $escrutinio[segundo] < escrutinio[i] < escrutinio[primero]$ \\

\noindent $E_8 \equiv  0 \leq i, segundo < |escrutinio| \yLuego \\
((escrutinio[i] > escrutinio[segundo] \land 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, i < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq i \implicaLuego escrutinio[j] < escrutinio[i]} \\ \land escrutinio[i] \leq escrutinio[primero] \land noHayEmpate(escrutinio) ) \lor \\ 
(escrutinio[i] \leq escrutinio[segundo] \land  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \\ 
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio)))$ \\

\noindent (Veamos que, escrutinio[i] $\leq$ escrutinio[segundo] $\equiv$ False, entonces el lado del derecho del or es falso.) \\

\noindent $\equiv  0 \leq i, segundo < |escrutinio| \yLuego \\
((escrutinio[i] > escrutinio[segundo] \land  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, i < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq i \implicaLuego escrutinio[j] < escrutinio[i]} \\ \land escrutinio[i] \leq escrutinio[primero] \land noHayEmpate(escrutinio)) $\\ 

\noindent (Todos los indices estaban en el rango correcto, por el invariante) \\

\noindent $\equiv
((escrutinio[i] > escrutinio[segundo] \land \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq i \implicaLuego escrutinio[j] < escrutinio[i]} \\ \land escrutinio[i] \leq escrutinio[primero] \land noHayEmpate(escrutinio)) $\\ 

\noindent (escrutinio[i] $>$ escrutinio[segundo] y escrutinio[i] $\leq$ escrutinio[primero] valen por la hipotesis, y noHayEmpate(escrutinio) es trivial) \\

\noindent $\equiv
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \implicaLuego escrutinio[j] < escrutinio[i]} $\\ 

\noindent (Si el antecedente es verdadero, y j = segundo tengo que escrutinio[j] = escrutinio[segundo], entonces escrutinio[j] $<$ escrutinio[i], por otro lado,
si j no es igual al segundo, escrutinio[j] $<$ escrutinio[segundo], y en consecuencia escrutinio[j] $<$ escrutinio[i]) \\

\noindent $E_8 \equiv True \rightarrow E_9 \equiv True$ \\

\noindent $\equiv  I \equiv 0 < i < |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i \yLuego \paraTodo[unalinea]{j}{\ent}{0 \leq j < i \land j \neq primero \land j \neq segundo \implicaLuego \\ escrutinio[j] < escrutinio[segundo]} \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio) 
\land \\ (escrutinio[i] < escrutinio[segundo] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[i] < escrutinio[primero] \lor escrutinio[segundo] < escrutinio[primero] < escrutinio[i]) 
$ \\

\noindent Para finalizar, veamos el caso que escrutinio[i] $<$ escrutinio[segundo] $<$ escrutinio[primero] \\

\noindent $E_8 \equiv  0 \leq i, segundo < |escrutinio| \yLuego \\
((escrutinio[i] > escrutinio[segundo] \land 0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, i < i + 1 \yLuego \\ \paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq i \implicaLuego escrutinio[j] < escrutinio[i]} \\ \land escrutinio[i] \leq escrutinio[primero] \land noHayEmpate(escrutinio) ) \lor \\ 
(escrutinio[i] \leq escrutinio[segundo] \land  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \\ 
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio)))$ \\

\noindent (escrtunio[i] $>$ escrutinio[segundo] $\equiv$ False, luego el lado izquierdo del or es falso) \\

\noindent $E_8 \equiv  0 \leq i, segundo < |escrutinio| \yLuego \\ 
(escrutinio[i] \leq escrutinio[segundo] \land  0 < i + 1 \leq |escrutinio| - 1 \yLuego  0 \leq primero, segundo < i + 1 \yLuego \\ 
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio))$ \\

\noindent (Los indicen estan en rango) \\

\noindent $E_8 \equiv
(escrutinio[i] \leq escrutinio[segundo] \land \\
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]} \\ \land escrutinio[segundo] \leq escrutinio[primero] \land noHayEmpate(escrutinio))$ \\

\noindent (escrutinio[i] $\leq$ escrutinio[segundo] y escrutinio[segundo] $\leq$ escrutinio[primero] salen de la hipotesis) \\

\noindent $E_8 \equiv
\paraTodo[unalinea]{j}{\ent}{0 \leq j < i + 1 \land j \neq primero \land j \neq segundo \implicaLuego escrutinio[j] < escrutinio[segundo]}$ \\

\noindent (Para todos los casos donde el atecedente es verdadero y j no es i, la expresion es verdadera pues aparece en el invariante. Por otro lado, cuando j = i y cumple el precedente, tambien vale por nuestra hipotesis de que escrutinio[i] $<$ escrutinio[segundo] $<$ escrutinio[primero]) \\

\noindent $E_8 \equiv True \rightarrow E_9 \equiv True$ \\

\noindent Podemos concluir entonces que $I \land B  \rightarrow E_9$ y por lo tanto la tripla de Hoare vale. \\

\noindent 4. Probemos que,  $I \land fv \leq 0 \rightarrow \neg B$ \\

\noindent $I \land fv \leq 0 \equiv I \land |escrutinio| \leq i \rightarrow |escrutinio| \leq i + 1 \equiv \neg B $\\

\noindent 5. Si probamos la tripla de Hoare $\{I \land B \land v_0 = fv\}$CuerpoDelCiclo$\{fv < v_0\}$ el ciclo termina y es correcto. \\

\noindent Calculamos la wp(If ...; i := i + 1, fv $<$ $v_0$)  $\equiv$ wp(If ..., wp(i := i + 1, fv $<$ $v_0$)) \\

\noindent \textbf{wp}(i := i + 1,   fv $<$ $v_0$) $\equiv$  def(i+1) $\yLuego$  $|escrutinio| - i < v_0 + 1 \equiv |escrutinio| - i < v_0 + 1 \equiv E_{10}$\\

\noindent \textbf{wp}(If ...,  $E_{10}$) $\equiv def(escrutinio[i] > escrutinio[primero]) \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land wp(segundo := primero; primero := i, E_{10})) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land wp(If ..., E_{10}))$\\

\noindent $\equiv 0 \leq i, primero < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land wp(segundo := primero, def(i) \yLuego |escrutinio| - i < v_0 + 1)) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (def(escrutinio[i] > escrutinio[segundo]) \yLuego \\ ((escrutinio[i] > escrutinio[segundo] \land wp(segundo := i, |escrutinio| - i < v_0 + 1) \lor \\ (escrutinio[i] \leq escrutinio[segundo] \land wp(skip, |escrutinio| - i < v_0 + 1))) ) )$\\

\noindent $\equiv 0 \leq i, primero < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land def(primero) \yLuego |escrutinio| - i < v_0 + 1) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (0 \leq i, segundo < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[segundo] \land def(i) \yLuego |escrutinio| - i < v_0 + 1 \lor \\ (escrutinio[i] \leq escrutinio[segundo] \land |escrutinio| - i < v_0 + 1))))))$\\

\noindent $\equiv 0 \leq i, primero < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[primero] \land |escrutinio| - i < v_0 + 1) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (0 \leq i, segundo < |escrutinio| \yLuego \\ ((escrutinio[i] > escrutinio[segundo] \land |escrutinio| - i < v_0 + 1 \lor \\ (escrutinio[i] \leq escrutinio[segundo] \land |escrutinio| - i < v_0 + 1)))))) \equiv E_{11}$\\

\noindent Asumamos que vale  $I \land B \land v_0 = fv$ y veamos que implica $E_{11}$ \\

\noindent $\equiv ((escrutinio[i] > escrutinio[primero] \land |escrutinio| - i < v_0 + 1) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (((escrutinio[i] > escrutinio[segundo] \land |escrutinio| - i < v_0 + 1 \lor \\ (escrutinio[i] \leq escrutinio[segundo] \land |escrutinio| - i < v_0 + 1))))))$ \\

\noindent ($v_0 = |escrutinio| - i$) \\

\noindent $\equiv ((escrutinio[i] > escrutinio[primero] \land v_0 < v_0 + 1) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (((escrutinio[i] > escrutinio[segundo] \land v_0 < v_0 + 1 \lor \\ (escrutinio[i] \leq escrutinio[segundo] \land v_0< v_0 + 1))))))$ \\

\noindent $\equiv (escrutinio[i] > escrutinio[primero]) \lor \\ (escrutinio[i] \leq escrutinio[primero] \land (escrutinio[i] > escrutinio[segundo] \lor \\ escrutinio[i] \leq escrutinio[segundo]))$ \\

\noindent Y, usando la reescritura del invariante del punto 3, tenemos que asumiendo cada caso por separado esta expresion es verdadera y por lo tanto la tripla vale.
\newpage 

\subsection{3. $Q_C \rightarrow wp(S_2, Asegura)$} \vspace{0.1cm}

\noindent Calculamos \textbf{wp}($S_2$, Asegura) \\

\noindent \textbf{wp}($res := (primero, segundo)$, Asegura) \vspace{0.1cm} \\
\noindent $\equiv$ def((primero, segundo)) $\yLuego$ $(0 \leq primero, segundo < |escrutinio| - 1) \yLuego \paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| - 1 \land i \neq primero \land  i \neq segundo \implicaLuego escrutinio[i] < escrutinio[segundo]} \land escrutinio[segundo] < escrutinio[primero] $ \\
\noindent $\equiv$  $(0 \leq primero, segundo < |escrutinio| - 1) \yLuego \paraTodo[unalinea]{i}{\ent}{0 \leq i < |escrutinio| - 1 \land i \neq primero \land  i \neq segundo \implicaLuego escrutinio[i] < escrutinio[segundo]} \land escrutinio[segundo] < escrutinio[primero] \equiv E_4$ \\

\noindent Quiero ver que $Q_c \rightarrow E_4$, lo cual vale pues son equivalentes. \vspace{0.1cm}\\

\noindent Una vez probadas (1), (2) y (3) por el corolario de monotonia, el programa es correcto respecto a su especificación.

\end{document}
